"use strict";!function(i){var n,a,s,t=ina_ajax.settings.timeout,r=1e3*t,u=0,c=ina_ajax.settings.countdown_timeout,d=ina_ajax.ajaxurl,l={onReady:function(){this.inactive_logout_tabID="",this.isActiveTab=!0,this.eventListeners(),this.startTimer()},eventListeners:function(){this.inactive_logout_tabID=sessionStorage.inactive_logout_tabID&&"2"!==sessionStorage.closedLastTab?sessionStorage.inactive_logout_tabID:sessionStorage.inactive_logout_tabID=Math.random(),sessionStorage.closedLastTab="2",window.addEventListener("beforeunload",function(t){sessionStorage.closedLastTab="1"}),localStorage.setItem("ina__browserTabID",this.inactive_logout_tabID),i(document).on("mousemove",this.resetTimer.bind(this)),i(document).on("mousedown",this.resetTimer.bind(this)),i(document).on("keydown",this.resetTimer.bind(this)),i(document).on("DOMMouseScroll",this.resetTimer.bind(this)),i(document).on("mousewheel",this.resetTimer.bind(this)),i(document).on("touchmove",this.resetTimer.bind(this)),i(document).on("MSPointerMove",this.resetTimer.bind(this)),i(document).ready(this.resetTimer.bind(this)),i(document).on("click",".ina_stay_logged_in",this.stayLoggedInWarnMsg),i(document).on("click",".btn-close-without-reload",this.stayLoggedInWarnMsg)},startTimer:function(){n=setTimeout(l.goInactive.bind(this),5e3)},resetTimer:function(){clearTimeout(n),clearTimeout(a),localStorage.setItem("ina__browserTabID",this.inactive_logout_tabID);try{this.startTimer()}catch(t){TypeError,console.log(t,!0)}},goInactive:function(){var t,o=this;0===u&&(t=localStorage.getItem("ina__browserTabID"),parseFloat(t)===parseFloat(o.inactive_logout_tabID)&&(t=Date.now(),t=Math.floor(t/1e3),t={action:"ina_checklastSession",do:"ina_updateLastSession",security:ina_ajax.ina_security,timestamp:t},i.post(d,t).done(function(t){if(!1!==t.success){var e=document.activeElement;if(e&&("IFRAME"===e.tagName||e.classList.contains("media-modal")))return o.resetTimer(),!1;a=setTimeout(function(){l.showTimeoutMessage(t)},r)}})))},showTimeoutMessage:function(e){var o,t=ina_ajax.settings.disable_countdown,n=ina_ajax.settings.warn_message_enabled;document.onkeydown=function(t){if(116!=(t.charCode||t.keyCode))return!1},window.oncontextmenu=function(){return!1},u=1,n?i("#ina__dp_logout_message_box").show().html(e.html):t?(t={action:"ina_checklastSession",do:"ina_logout",security:ina_ajax.ina_security},i.post(d,t).done(function(t){return t.redirect_url?(i("#ina__dp_logout_message_box").show().html(e.html),i("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+t.msg+"<p>"),l.logout_now(t.redirect_url)):(i("#ina__dp_logout_message_box").show().html(e.html),i("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+t.msg+"</p>"),l.logout_now(!1)),!1})):(c=ina_ajax.settings.countdown_timeout,i("#ina__dp_logout_message_box").show().html(e.html),s=setInterval(function(){var t;0<=c&&(o=c--,i(".ina_countdown").html("("+l.secondsToHms(o)+")")),0===o&&(clearTimeout(s),t={action:"ina_checklastSession",do:"ina_logout",security:ina_ajax.ina_security},i.post(d,t).done(function(t){return t.redirect_url?(i("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+t.msg+"<p>"),l.logout_now(t.redirect_url)):(i("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+t.msg+"</p>"),l.logout_now(!1)),!1}))},1e3))},stayLoggedInWarnMsg:function(){document.onkeydown=function(t){return!0},window.oncontextmenu=null,clearTimeout(s),c=ina_ajax.settings.countdown_timeout,u=0,i("#ina__dp_logout_message_box").hide(),i(".ina_countdown").text("")},logout_now:function(t){var o=this,e={action:"ina_logout_session",security:ina_ajax.ina_security};i.post(d,e).done(function(e){clearTimeout(n),localStorage.removeItem("ina__browserTabID"),t&&(window.location=t),document.onkeydown=function(t){return!0},0<i(".ina-debugger-section").length&&i(".ina-debugger-section").hide(),i("form#ina-ajaxlogin-form").on("submit",function(t){i(".ina-login-status").show().text("* "+ina_ajax.i10n.login_wait+"...").css("color","#2b8605"),i.ajax({type:"POST",dataType:"json",url:ina_ajax.ajaxurl,data:{action:"ina_ajaxlogin",username:i("form#ina-ajaxlogin-form #ina-username").val(),password:i("form#ina-ajaxlogin-form #ina-password").val(),nonce:e.nonce},success:function(t){!0===t.success?(i(".ina-login-status").html(t.data.message).css("color","#2b8605"),0<i(".ina-debugger-section").length&&i(".ina-debugger-section").show(),o.stayLoggedInWarnMsg()):i(".ina-login-status").html(t.data.message)}}),t.preventDefault()}),console.log("Session Logged Out !!")})},secondsToHms:function(t){t=Number(t);var e=Math.floor(t/3600),o=Math.floor(t%3600/60),t=Math.floor(t%3600%60);return(0<e?e+(1==e?" "+ina_ajax.i10n.hour+", ":" "+ina_ajax.i10n.hours+", "):"")+(0<o?o+(1==o?" "+ina_ajax.i10n.minute+", ":" "+ina_ajax.i10n.minutes+", "):"")+(0<t?t+(1==t?" "+ina_ajax.i10n.second:" "+ina_ajax.i10n.seconds):"")}},e={init:function(){this.cacheElem(),this.evntLoaders(),this.startTimer()},cacheElem:function(){this.timeoutID=null,this.timeoutMessage=null,this.timeout=t,this.timeout_defined=this.timeout,this.countdown=0,this.ajax_url=ina_ajax.ajaxurl,this.debuggerState=localStorage.getItem("ina__debuggerWindow"),this.mainDebuggerWrapper=i(".ina-debugger-section")},evntLoaders:function(){i(document).on("mousemove",this.resetTimer.bind(this)),i(document).on("mousedown",this.resetTimer.bind(this)),i(document).on("keydown",this.resetTimer.bind(this)),i(document).on("DOMMouseScroll",this.resetTimer.bind(this)),i(document).on("mousewheel",this.resetTimer.bind(this)),i(document).on("touchmove",this.resetTimer.bind(this)),i(document).on("MSPointerMove",this.resetTimer.bind(this)),i(".ina-debugger-section-btn-close").on("click",this.closeDebuggerWindow.bind(this)),"closed"===this.debuggerState&&(this.mainDebuggerWrapper.css({width:"10px",padding:"20px",height:"180px"}),this.mainDebuggerWrapper.find("ul").hide(),i(".ina-debugger-section-btn-close").data("state","open").removeClass("ina-debugger-section-btn-close").addClass("ina-debugger-section-btn-open"))},closeDebuggerWindow:function(t){var e=i(t.currentTarget).data("state"),o=this.mainDebuggerWrapper;"close"===e?(o.css({width:"10px",padding:"20px",height:"180px"}),o.find("ul").hide(),i(t.currentTarget).data("state","open").removeClass("ina-debugger-section-btn-close").addClass("ina-debugger-section-btn-open"),localStorage.setItem("ina__debuggerWindow","closed")):(o.css({width:"auto",padding:"20px 80px 20px 20px",height:"auto"}),o.find("ul").show(),i(t.currentTarget).data("state","close").removeClass("ina-debugger-section-btn-open").addClass("ina-debugger-section-btn-close"),localStorage.removeItem("ina__debuggerWindow"))},resetTimer:function(){clearTimeout(this.timeoutID),clearInterval(this.timeoutMessage),this.timeout_defined=this.timeout;try{this.startTimer()}catch(t){TypeError,console.log(t,!0)}},startTimer:function(){i(".coutdown-timer").html("Waiting for Inactivity..."),this.timeoutID=setTimeout(this.goInactive.bind(this),5e3)},goInactive:function(){var t=this,e=localStorage.getItem("ina__browserTabID");parseFloat(e)===parseFloat(l.inactive_logout_tabID)&&(this.timeoutMessage=setInterval(function(){t.timeout_defined--,0<t.timeout_defined?i(".coutdown-timer").html("<strong>Countdown to Logout:</strong> "+t.secondsToHms(t.timeout_defined)):i(".coutdown-timer").html("Initiating Logout !")},1e3))},secondsToHms:function(t){t=Number(t);var e=Math.floor(t/3600),o=Math.floor(t%3600/60),t=Math.floor(t%3600%60);return(0<e?e+(1==e?" "+ina_ajax.i10n.hour+", ":" "+ina_ajax.i10n.hours+", "):"")+(0<o?o+(1==o?" "+ina_ajax.i10n.minute+", ":" "+ina_ajax.i10n.minutes+", "):"")+(0<t?t+(1==t?" "+ina_ajax.i10n.second:" "+ina_ajax.i10n.seconds):"")}};i(function(){l.onReady(),ina_ajax.settings.enable_debugger&&e.init()})}(jQuery);